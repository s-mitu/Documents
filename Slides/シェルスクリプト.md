# シェルスクリプト

鈴木光宏
---

## シェルとは

* ユーザー空間からOSカーネルを操作するプログラム
 * デバイスや資源の割当などを扱うカーネルは直接扱うのは難しく危険
 * シェルを間に挟むことで、安全性と操作性が向上する

---
## ユーザー空間のシェルとカーネルの関係

```
            +----------+ コマンド入力 +-------------+
            |          |<-------------| ユーザ端末  |
            |  シェル  |   結果出力   | (モニタ ＋  |
            |          |------------->|  キーボード)|
            +----------+              +-------------+
ユーザ空間      A  |                                 
--------------- |  | --------------                  
カーネル空間    |  V システムコール                  
            +----------+                             
            | カーネル |                             
            +----------+                             
```

---
## 一般的なシェル

* グラフィカル(GUI)なものも、コマンドライン(CUI)のものもある
 * Windows ならエクスプローラーがグラフィカルシェル、cmd.exeがCUIシェル
 * UNIX系はCUIがシェル（GUI環境もシェルから呼び出される）

**→ 今回の説明ではCUIのシェルについてお話します**

---
# シェルの役割
---
## システム処理を行う

* OS の起動時などに、サーバーの起動、システム設定のために実行
* あらかじめスクリプトファイルに書かれたコマンドをまとめて実行
* システムから呼び出される回数が多いので小さくてシンプルに作られる
 
## ユーザー操作

* コンピュータを操作するためのヒューマンインターフェース
* 人間が逐次コマンドを入力することで、コンピュターを操作する
* 人間操作のため、補完機能や履歴など補助する機能が豊富

---
# シェルの機能
---
## コマンドの実行

シェルが内部で持っているコマンドや外部コマンドを実行する。

例：ファイルのコピー

```
$ cp a.txt b.txt
```

例：文字列出力

```
$ echo "Hello World"
Hello World
```

---
## リダイレクト
* コマンドのデータの入出力（標準入力・標準出力）を切り替える
* 切り替える先はファイルや他のコマンドなど
* ">" で出力 "<" で入力 ">>"で追記

例：ファイルのリストをファイルに出力する

```
$ ls /etc > filelist
```

---

## パイプ
* リダイレクトでコマンドの出力先と入力先を組み合わせる
* 他のコマンドが処理した結果を更に他のコマンドに渡して処理させる

例：ファイルリストを辞書順に並び替える

```
$ ls | sort 
```

---
## UNIX の基本的な考え
* ひとつの多機能で巨大なプログラムですべて解決するのではなく、シンプルなコマンドを組み合わせて様々な処理をする。
 * 例: ls コマンドには大した並べ替え機能はない。並べ替えは sort コマンドで行う
 * 各コマンドはパイプでつないでいくことが前提で作られている

* プレーンテキスト至上主義
 * バイナリのほうが目先の効率はいいが、「ヒューマンリーダブル」のわかりやすさ、システム非依存性を優先する。
---
## プログラム言語としてのシェル
通常のプログラミング言語のようなシンタックスも用意されている
* 変数 $a $b
* 条件分岐 (if, case など)
* ループ (for, while)
* 関数
---
## シェルはグルー(のり)言語
* シェルはシェル自体が頑張るよりも、他のコマンドを組み合わせるための「のり（グルー）」として振る舞うほうが効率がいい
* 変数処理は遅い
 * 内部的に単なる文字列処理なので効率が悪い
* ループで処理すると遅い
 * 全部をコマンドにパイプで投げて一気に処理する方がシェルに向いている
* ファイルに出力したほうが効率がいいことが多い
 * 資源が豊かな環境ではディスクキャッシュされてオンメモリ処理となる
* パイプで繋がれた各コマンドは別プロセス
 * マルチコア環境ならばそれぞれにCPU資源が割り当てられるため、スケールする。
---
# 様々なシェル
---
## よく使われる主なシェル

* sh
 * Bourne shell または POSIX シェル
 * 様々な環境で標準でインストールされている
 * リダイレクトの指定が柔軟に行える
 * 補完機能などは貧弱
 * 少ない使用メモリ
 * 主にシステムシェルとして使われる
 * sh で動くシェルスクリプトを書けば、様々な環境で動く
